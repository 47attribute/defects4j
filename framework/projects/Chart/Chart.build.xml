<project name="D4J-Chart"  basedir="${basedir}">

    <fail message="Property d4j.home not set!" unless="d4j.home" />
    <property name="junit.jar" value="${d4j.home}/framework/projects/lib/junit-4.11.jar"/>

    <!-- Include existing project build file -->
    <import file="${basedir}/ant/build.xml" />

    <!-- Import general build file -->
    <import file="../defects4j.build.xml" />

    <!-- Values necessary for mutation scripting to work -->
    <property name="test.home" value="${basedir}/build-tests" />
    <property name="build.home" value="${basedir}" />
    <property name="classes.dir" value="${basedir}/build" />
    <path id="compile.classpath" refid="build.classpath" />

    <!-- target used for compiling sources. This was replicated to avoid deleting the compilation directory -->
    <target name="compile" depends="initialise"
            description="Compile the JFreeChart source code.">

        <!-- create a temp build directory -->
        <mkdir dir="${basedir}/build" />

        <javac srcdir="${basedir}/source"
               destdir="${basedir}/build"
               debug="on"
               deprecation="false"
               source="1.4"
               target="1.4">
            <classpath refid="build.classpath" />
            <include name="org/jfree/**"/>
        </javac>

        <!-- copy across gorilla.jpg -->
        <copy file="${basedir}/source/org/jfree/chart/gorilla.jpg" tofile="${basedir}/build/org/jfree/chart/gorilla.jpg" />

        <!-- copy across .properties files -->
        <copy todir="${basedir}/build/org/jfree/chart/">
            <fileset dir="${basedir}/source/org/jfree/chart">
                <include name="*.properties" />
            </fileset>
        </copy>
        <copy todir="${basedir}/build/org/jfree/chart/plot">
            <fileset dir="${basedir}/source/org/jfree/chart/plot">
                <include name="*.properties" />
            </fileset>
        </copy>
        <copy todir="${basedir}/build/org/jfree/chart/editor">
            <fileset dir="${basedir}/source/org/jfree/chart/editor">
                <include name="*.properties" />
            </fileset>
        </copy>
        <copy todir="${basedir}/build/org/jfree/chart/ui">
            <fileset dir="${basedir}/source/org/jfree/chart/ui">
                <include name="*.properties" />
            </fileset>
        </copy>
    </target>


    <!-- Compile the experimental classes.  This was replicated to avoid deleting the compilation directory -->
    <target name="compile-experimental" depends="compile"
            description="Compile the JFreeChart experimental classes">

        <!-- create a temp build directory -->
        <mkdir dir="${basedir}/build" />

        <path id="build.experimental.classpath">
            <pathelement location="${servlet.jar}"/>
        </path>

        <!-- compile the source -->
        <javac srcdir="${basedir}/experimental"
               destdir="${basedir}/build"
               debug="on"
               deprecation="false"
               source="1.4"
               target="1.4">
            <classpath refid="build.experimental.classpath" />
            <include name="org/jfree/experimental/**"/>
            <exclude name="org/jfree/experimental/**/junit/*"/>
        </javac>
    </target>


    <!-- dummy target, used to rename -->
    <target name="compile.tests" depends="compile, compile-experimental">
         <mkdir dir="${basedir}/build-tests"/>
        <javac srcdir="${basedir}/tests"
               destdir="${basedir}/build-tests"
               source="1.4"
               target="1.4"
               debug="true"
               deprecation="false"
               optimize="false">
            <classpath>
                <path refid="build.classpath"/>
                <pathelement location="${junit.jar}"/>
                <pathelement location="${classes.dir}" />
                <pathelement location="${basedir}/build-tests"/>
            </classpath>
        </javac>
    </target>

    <!-- List of all developer-written tests that reliably pass on the fixed version -->
    <fileset id="all.manual.tests" dir="${basedir}/tests" excludes="${d4j.tests.exclude}">
        <include name="**/*Tests.java"/>
        <exclude name="**/*Package*.java"/>
    </fileset>

    <!-- Classpath to run developer-written tests -->
    <path id="d4j.test.classpath">
        <path refid="build.classpath"/>
        <pathelement location="${junit.jar}"/>
        <pathelement location="${classes.dir}" />
        <pathelement location="${basedir}/build-tests"/>
    </path>
</project>
